<!DOCTYPE html>
<html>
  <head>
    <title>Vanity &mdash; Testing Emails</title>
    <link href="css/page.css" media="screen,print" rel="stylesheet" type="text/css">
    <link href="css/print.css" media="print" rel="stylesheet" type="text/css">
    <link href="images/favicon.png" rel="shortcut icon">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="site.js"></script>
  </head>
  <body>
    <div id="header">
      <div class="title"><a href="http://vanity.labnotes.org" title="Mirror, mirror, on the wall &hellip;">Vanity</a></div>
      <div class="tagline">Experiment<br>Driven Development</div>
    </div>
    <div id="links">
      <a href="http://github.com/assaf/vanity">Source code</a> |
      <a href="http://stackoverflow.com/questions/tagged/vanity" title="stackoverflow vanity tag">StackOverflow Tag</a> |
      <a href="http://rdoc.info/gems/vanity">API reference</a>
    </div>
    <div id="sidebar">
      <ul>
        <li><a href="index.html#intro" title="A/B Testing with Rails">Intro</a></li>
        <li><a href="metrics.html">Metrics</a></li>
        <li><a href="ab_testing.html" title="Everything you need to know">A/B Testing</a></li>
        <li><a href="rails.html">Using with Rails</a></li>
        <li><a href="email.html">Testing emails</a></li>
        <li><a href="identity.html">Managing Identity</a></li>
        <li><a href="configuring.html">Configuring</a></li>
        <li><a href="adapters.html">Adapters</a></li>
        <li><a href="contributing.html">Contributing</a></li>
        <li><a href="experimental.html">Experimental</a></li>
      </ul>
      <ul id="stats">
        <li><a href="http://travis-ci.org/assaf/vanity"><img src="https://api.travis-ci.org/assaf/vanity.png?branch=master"></a></li>
        <li><a href="http://wiki.github.com/assaf/vanity/whos-using-vanity">Who's using it?</a></li>
      </ul>
    </div>
    <div id="content">
      <h1 id="testing emails">Testing Emails</h1>
      <div id="toc">
<ol>
	<li><a href="#config">Configuring ActionMailer</a></li>
	<li><a href="#subject">Testing email subject lines</a></li>
	<li><a href="#content">Testing email content</a><br />
</div></li>
</ol>
<h3 id="config">Configuring ActionMailer</h3>
<p>First setup Rails to send email. For example, if you are using GMail you can setup your <span class="caps">SMTP</span> settings like this:</p>
<pre>
ActionMailer::Base.smtp_settings = {
  :address =&gt; "smtp.gmail.com",
  :port =&gt; "587",
  :domain =&gt; "gmail.com",
  :authentication =&gt; :plain,
  :user_name =&gt; "your-email@gmail.com",
  :password =&gt; "your-pass"
}
</pre>
<h3 id="subject">Testing email subject lines</h3>
<p>In your <code>RAILS_ROOT/experiments/</code> folder create an experiment file. For example:</p>
<pre>
ab_test "Invite subject" do
  description "Optimize invite subject line"
  alternatives "Join now!", "You're invited to an exclusive event."
  metrics :open
end
</pre>
<p>In your <code>RAILS_ROOT/experiments/metrics/</code> folder create a metric file for the metric you are testing. For example:</p>
<pre>
metric "Open (Activation)" do
  description "Measures how many recipients opened an email."
end
</pre>
<p>Create an ActionMailer class, for example:</p>
<pre>
class UserMailer &lt; ActionMailer::Base
  def invite_email(user)
    use_vanity_mailer user
    mail :to =&gt; user.email, :subject =&gt;ab_test(:invite_subject)
  end
end
</pre>
<p>We set the identity of the &#8220;user&#8221; in the <code>use_vanity_mailer</code> method. This can take a string or an object that responds to id. If it&#8217;s nil then it will set it as a random number. Setting the appropriate context is important to have each user consistently get the same alternative in our experiment.</p>
<p>Now we need to include a tracking image in the email content.  We pass in the vanity identity which we set when we called <code>use_vanity_mailer(user)</code> and the metric we are tracking.</p>
<pre>
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
    &lt;head&gt;
      &lt;meta content="text/html; charset=UTF-8" http-equiv="Content-Type"&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Hey Joseph&lt;/h1&gt;
      &lt;p&gt;
        &lt;%= vanity_tracking_image(Vanity.context.vanity_identity, :open, :host =&gt; "127.0.0.1:3000") %&gt;
      &lt;/p&gt;
    &lt;/body&gt;
  &lt;/html&gt;
</pre>
<p>Last, we have to include the <code>TrackingImage</code> module into our <code>VanityController</code>.  This is the same place that you can include the <code>Dashboard</code>.</p>
<p><code>Vanity::Rails::TrackingImage</code> will add a image method that will render a blank image.</p>
<pre>
class VanityController &lt; ApplicationController
  include Vanity::Rails::Dashboard
  include Vanity::Rails::TrackingImage
end
</pre>
<h3 id="subject">Testing email content</h3>
<p>In your <code>RAILS_ROOT/experiments/</code> folder create a new experiment file:</p>
<pre>
ab_test "Invite text" do
  description "Optimize invite text"
  alternatives "A friend of yours invited you to use Vanity", "Vanity is the latest and greatest in a/b testing technology"
  metrics :click
end
</pre>
<p>In your <code>RAILS_ROOT/experiments/metrics/</code> folder create a metric file for the metric you are testing:</p>
<pre>
metric "Click (Acquisition)" do
  description "Measures clickthough on email."
end
</pre>
<p>A/B test your email content:</p>
<pre>
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
    &lt;head&gt;
      &lt;meta content="text/html; charset=UTF-8" http-equiv="Content-Type"&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Hi!&lt;/h1&gt;
      &lt;p&gt;
        &lt;%= link_to ab_test(:invite_text), vanity_track_url_for(Vanity.context.vanity_identity, :click, :controller =&gt; "home", :action =&gt; "index", :host =&gt; "127.0.0.1:3000") %&gt;
      &lt;/p&gt;
    &lt;/body&gt;
  &lt;/html&gt;
</pre>
<p>Here we use the text from the &#8220;invite_text&#8221; experiment and then use the <code>vanity_track_url_for</code> helper to add the identity and the metric to track into the url so that Vanity can track the click-throughs.</p>
    </div>
    <div id="footer"><a href="credits.html">Credits / License</a></div>
    <script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_setAccount", "UA-1828623-6"], ["_trackPageview"]);(function(){var ga=document.createElement("script");ga.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";ga.setAttribute("async", "true");document.documentElement.firstChild.appendChild(ga);})();</script>
  </body>
</html>
