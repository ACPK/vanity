<!DOCTYPE html>
<html>
  <head>
    <title>Vanity &mdash; Managing Identity</title>
    <link href="css/page.css" media="screen,print" rel="stylesheet" type="text/css">
    <link href="css/print.css" media="print" rel="stylesheet" type="text/css">
    <link href="images/favicon.png" rel="shortcut icon">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="site.js"></script>
  </head>
  <body>
    <div id="header">
      <div class="title"><a href="http://vanity.labnotes.org" title="Mirror, mirror, on the wall &hellip;">Vanity</a></div>
      <div class="tagline">Experiment<br>Driven Development</div>
    </div>
    <div id="links">
      <a href="http://github.com/assaf/vanity">Source code</a> |
      <a href="http://stackoverflow.com/questions/tagged/vanity" title="stackoverflow vanity tag">StackOverflow Tag</a> |
      <a href="http://rdoc.info/gems/vanity">API reference</a>
    </div>
    <div id="sidebar">
      <ul>
        <li><a href="index.html#intro" title="A/B Testing with Rails">Intro</a></li>
        <li><a href="metrics.html">Metrics</a></li>
        <li><a href="ab_testing.html" title="Everything you need to know">A/B Testing</a></li>
        <li><a href="rails.html">Using with Rails</a></li>
        <li><a href="email.html">Testing emails</a></li>
        <li><a href="identity.html">Managing Identity</a></li>
        <li><a href="configuring.html">Configuring</a></li>
        <li><a href="adapters.html">Adapters</a></li>
        <li><a href="contributing.html">Contributing</a></li>
        <li><a href="experimental.html">Experimental</a></li>
      </ul>
      <ul id="stats">
        <li><a href="http://travis-ci.org/assaf/vanity"><img src="https://api.travis-ci.org/assaf/vanity.png?branch=master"></a></li>
        <li><a href="http://wiki.github.com/assaf/vanity/whos-using-vanity">Who's using it?</a></li>
      </ul>
    </div>
    <div id="content">
      <h1 id="managing identity">Managing Identity</h1>
      <p>For effective A/B tests, you want to:</p>
<ol>
	<li>Randomly show different alternatives to different people</li>
	<li>Consistently show the same alternative to the same person</li>
	<li>Know which alternative you&#8217;re showing and tracking</li>
	<li>When running multiple tests at once, keep them independent</li>
</ol>
<p>Vanity can assign each visitor a unique identifier and store it in a cookie that persists across sessions. That way, each visitor will get to see the same alternatives on repeating visits. (Assuming they use the same browser on all visits.)</p>
<p>If you have a more persistant way of tracking visitors, e.g. using sign in, you&#8217;ll want to use that instead. That way the same person gets treated to the same experiment, even if they switch between machines and browsers.</p>
<p>You can choose either option using the <code>use_vanity</code> method.  In the first case, just call <code>use_vanity</code> from within the <code>ApplicationController</code>. In the second case, you&#8217;ll want to pass <code>use_vanity</code> either a block that returns an identity value, or the name of a method that returns an object which provides the identity when <code>id</code> is called on it. If you pass a method name and it returns <code>nil</code>, Vanity will fallback on the persistent cookie mechanism.</p>
<p>Sounds complicated? These two examples are equivalent:</p>
<pre>
class ApplicationController &lt; ActionController::Base
  use_vanity :current_user

  def current_user
    User.find(session[:user_id])
  end
end
</pre>

<pre>
class ApplicationController &lt; ActionController::Base
  use_vanity :current_user

  def current_user
    user = User.find(session[:user_id])

    user if user &amp;&amp; user.id
  end
end
</pre>
<p>If <code>current_user</code> does not return <code>nil</code> for non-persisted accounts, e.g. it returns a <code>NullUser</code>, the <code>id</code> call should return <code>nil</code>.</p>
<p>If you pass a block, it must return a non-nil value. For example:</p>
<pre>
class ProjectController &lt; ApplicationController
  use_vanity { |controller| controller.params[:project_id] ||  }
end
</pre>
<p>An identity can be anything.  For example, if you&#8217;re running an experiment to test a new feature that will be available in some projects but not others, you&#8217;ll want to slice the audience by project identifier, not user ID.</p>
<p>You can also give each experiment a different identity using the <code>identify</code> callback.  Here&#8217;s an example that tells one experiment to use a project identifier:</p>
<pre>
ab_test "New feature" do
  description "New feature only available to some projects"
  identify { |c| c.current_project.id }
end
</pre>
    </div>
    <div id="footer"><a href="credits.html">Credits / License</a></div>
    <script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_setAccount", "UA-1828623-6"], ["_trackPageview"]);(function(){var ga=document.createElement("script");ga.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";ga.setAttribute("async", "true");document.documentElement.firstChild.appendChild(ga);})();</script>
  </body>
</html>
