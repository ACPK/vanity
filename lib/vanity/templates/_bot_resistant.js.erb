<% unless @_vanity_experiments.empty? %>
  var httpRequest;
  <%
    @_vanity_experiments.each do |key, val| 
  %>
    var params = "e=<%= key %>&a=<%= val %>&authenticity_token=" + encodeURIComponent("<%= form_authenticity_token %>");
    if (window.XMLHttpRequest) { // Mozilla, Safari, ...
      httpRequest = new XMLHttpRequest();
      if (httpRequest.overrideMimeType) {
	httpRequest.overrideMimeType('text/xml');
      }
    } else if (window.ActiveXObject) { // IE
      try { httpRequest = new ActiveXObject("Msxml2.XMLHTTP"); }
      catch (e) {
	try { httpRequest = new ActiveXObject("Microsoft.XMLHTTP"); }
	catch (e) {}
      }
    }
    if (httpRequest) {
      httpRequest.open('POST', "<%= Vanity.chooses_path %>", true);
      httpRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      httpRequest.setRequestHeader("Content-length", params.length);
      httpRequest.setRequestHeader("X-Requested-With", "XMLHttpRequest");
      httpRequest.setRequestHeader("Connection", "close");
      httpRequest.send(params);
    }
  <% end %>
<% end %>
